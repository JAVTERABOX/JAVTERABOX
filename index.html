<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JAVTerabox</title>
  <link rel="icon" href="https://cdn-1.webcatalog.io/catalog/terabox/terabox-icon-filled-256.png?v=1757896627824" type="image/png">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#111; color:#eee; }
    header { background:#b30000; color:#fff; padding:15px; text-align:center; font-size:24px; font-weight:bold; cursor:pointer; }
    header span { color:#fff; text-decoration:none; }
    #search-box { text-align:center; margin:15px; }
    #search-input { width:80%; max-width:400px; padding:8px; border:none; border-radius:5px; }
    #search-btn { padding:8px 12px; margin-left:5px; border:none; background:#b30000; color:#fff; border-radius:5px; cursor:pointer; }
    #posts { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:15px; padding:15px; }
    .post { background:#222; border-radius:10px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.5); transition:transform 0.2s; }
    .post:hover { transform:scale(1.02); }
    .post img { width:100%; display:block; }
    .post h2 { font-size:16px; padding:10px; margin:0; color:#fff; }
    .tags span, .post p { font-size:12px; margin:2px; display:inline-block; color:#aaa; cursor:pointer; }
    #pagination { text-align:center; margin:20px; }
    #pagination button { margin:2px; padding:6px 10px; border:none; background:#444; color:#fff; border-radius:5px; cursor:pointer; }
    #pagination button.active { background:#b30000; }
    #detail { padding:20px; max-width:800px; margin:auto; display:none; }
    #detail img { width:100%; max-width:600px; display:block; margin:auto; border-radius:10px; position:relative; }
    #detail h2 { text-align:center; margin:15px 0; }
    .download-btn { display:block; margin:15px auto; padding:12px 20px; background:#b30000; color:#fff; text-align:center; border-radius:5px; font-weight:bold; text-decoration:none; }
    .back-btn { display:block; margin:10px auto; text-align:center; color:#aaa; text-decoration:none; }
    #related { margin-top:30px; }
    #related h3 { text-align:center; margin-bottom:15px; color:#fff; }
    #related-posts { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:10px; }
    #related-posts .post h2 { font-size:12px; }
    /* === POPUP TELEGRAM === */
    #popup { position:fixed; bottom:20px; right:20px; background:#fff; border-radius:10px; padding:10px 15px; box-shadow:0 4px 10px rgba(0,0,0,0.3); display:flex; align-items:center; z-index:1000; }
    #popup img { width:30px; margin-right:10px; }
    #popup a { text-decoration:none; font-weight:bold; color:#0088cc; }
    #popup-close { margin-left:10px; cursor:pointer; font-size:18px; }
  </style>
</head>
<body>
  <header onclick="goHome()">JAVTerabox</header>

  <div id="search-box">
    <input type="text" id="search-input" placeholder="Search by code, actress, tags...">
    <button id="search-btn">Search</button>
  </div>

  <div id="posts"></div>
  <div id="pagination"></div>

  <div id="detail"></div>

  <!-- === POPUP TELEGRAM === -->
  <div id="popup">
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram">
    <a href="https://t.me/asetplay" target="_blank">Join Telegram</a> 
    <span id="popup-close">&#x2715;</span>
  </div>

  <script>
    const SHEET_URL = 'https://opensheet.elk.sh/15m33t4659Iq9unQ7_Gi-lOPe6Jj9T7wzAA060HxyFRs/Sheet1';
    const POSTS_PER_PAGE = 20;
    let allPosts = [];
    let currentPage = 1;

    async function fetchPosts() {
      const res = await fetch(SHEET_URL);
      allPosts = await res.json();
      // urut terbaru ke lama
      allPosts.reverse();
      renderPage(1);
    }

    function renderPage(page) {
      currentPage = page;
      const container = document.getElementById('posts');
      const detail = document.getElementById('detail');
      container.style.display = 'grid';
      detail.style.display = 'none';

      const start = (page - 1) * POSTS_PER_PAGE;
      const paginated = allPosts.slice(start, start + POSTS_PER_PAGE);

      container.innerHTML = paginated.map(p => `
        <div class="post" onclick="showDetail('${p.CODE}')">
          <img src="${p['LINK FOTO']}" alt="${p.CODE}">
          <h2>${p.CODE} ${p.Actress || ''}</h2>
        </div>
      `).join('');

      renderPagination();
    }

    function renderPagination() {
      const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
      const pagDiv = document.getElementById('pagination');
      let buttons = '';

      const start = Math.max(1, currentPage - 2);
      const end = Math.min(totalPages, start + 4);

      if (currentPage > 1) buttons += `<button onclick="renderPage(${currentPage-1})">&lt;</button>`;
      for (let i=start; i<=end; i++) {
        buttons += `<button onclick="renderPage(${i})" class="${i===currentPage?'active':''}">${i}</button>`;
      }
      if (currentPage < totalPages) buttons += `<button onclick="renderPage(${currentPage+1})">&gt;</button>`;
      pagDiv.innerHTML = buttons;
    }

    function showDetail(code) {
      const post = allPosts.find(p => p.CODE === code);
      if (!post) return;
      const container = document.getElementById('detail');
      document.getElementById('posts').style.display = 'none';
      container.style.display = 'block';
      window.scrollTo({ top: 0, behavior: 'smooth' });

      container.innerHTML = `
        <h2 onclick="window.open('${post.LINK}','_blank')">${post.CODE} ${post.Actress || ''}</h2>
        <img src="${post['LINK FOTO']}" alt="${post.CODE}">
        <a href="${post.LINK}" target="_blank" class="download-btn">Watch and Download</a>
        <a href="javascript:goHome()" class="back-btn">Back to List</a>
        <div id="related">
          <h3>Related Posts</h3>
          <div id="related-posts"></div>
        </div>
      `;

      renderRelated(post.CODE);
    }

    function renderRelated(currentCode) {
      const relatedContainer = document.getElementById('related-posts');
      const others = allPosts.filter(p => p.CODE !== currentCode).slice(0,8);
      relatedContainer.innerHTML = others.map(p => `
        <div class="post" onclick="showDetail('${p.CODE}')">
          <img src="${p['LINK FOTO']}" alt="${p.CODE}">
          <h2>${p.CODE} ${p.Actress || ''}</h2>
        </div>
      `).join('');
    }

    function goHome() {
      renderPage(1);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // === SEARCH ===
    document.getElementById('search-btn').addEventListener('click', doSearch);
    document.getElementById('search-input').addEventListener('keypress', e => { if(e.key==='Enter') doSearch(); });

    function doSearch() {
      const q = document.getElementById('search-input').value.toLowerCase();
      const results = allPosts.filter(p =>
        (p.CODE && p.CODE.toLowerCase().includes(q)) ||
        (p.Actress && p.Actress.toLowerCase().includes(q)) ||
        (p.Tags && p.Tags.toLowerCase().includes(q))
      );
      if (results.length === 0) {
        document.getElementById('posts').innerHTML = `<p style="text-align:center;">No results found for "<b>${q}</b>"</p>`;
        return;
      }
      allPosts = results;
      renderPage(1);
    }

    // === POPUP CLOSE ===
    document.getElementById('popup-close').onclick = () => document.getElementById('popup').style.display='none';

    fetchPosts();
  </script>
</body>
</html>
