<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JAVTerabox</title>
  <link rel="icon" type="image/png" href="https://cdn-1.webcatalog.io/catalog/terabox/terabox-icon-filled-256.png?v=1757896627824">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header { background:#b30000; color:#fff; padding:15px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:24px; cursor:pointer; }
    #search-box { display:flex; gap:5px; }
    #searchInput { padding:5px; font-size:14px; }
    #searchBtn { padding:6px 10px; background:#fff; border:none; cursor:pointer; }

    main { padding:20px; max-width:1200px; margin:auto; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px,1fr)); gap:15px; }
    .card { background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); cursor:pointer; display:flex; flex-direction:column; }
    .card img { width:100%; height:0; padding-top:56.25%; object-fit:cover; background:#ddd; position:relative; }
    .card h3 { margin:10px; font-size:16px; }

    .pagination { text-align:center; margin:20px 0; }
    .pagination button { margin:0 3px; padding:6px 10px; border:none; background:#ddd; cursor:pointer; border-radius:4px; }
    .pagination button.active { background:#b30000; color:#fff; }

    /* === DETAIL === */
    .detail { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.2); }
    .detail img { width:100%; border-radius:10px; position:relative; }
    .play-button { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:80px; height:80px; background:rgba(0,0,0,0.5); border-radius:50%; display:flex; justify-content:center; align-items:center; }
    .play-button::after { content:"â–¶"; font-size:40px; color:#fff; margin-left:5px; }
    .detail h2 { margin:15px 0; font-size:22px; }
    .meta { margin-bottom:10px; }
    .meta span { margin-right:10px; cursor:pointer; color:#b30000; }
    .download-btn { display:block; text-align:center; margin:15px auto; background:#b30000; color:#fff; padding:10px 20px; text-decoration:none; border-radius:6px; font-weight:bold; }
    .back-btn { display:block; text-align:center; margin-top:10px; text-decoration:none; color:#555; }

    /* === RELATED === */
    .related { margin-top:30px; }
    .related h3 { font-size:18px; margin-bottom:15px; }
    .related-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px,1fr)); gap:15px; }
    .related-card { background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); cursor:pointer; }
    .related-card img { width:100%; height:0; padding-top:56.25%; object-fit:cover; background:#ddd; }
    .related-card h4 { margin:10px; font-size:14px; }
    .related-pagination { text-align:center; margin-top:15px; }
    .related-pagination button { margin:0 3px; padding:5px 8px; border:none; background:#ddd; cursor:pointer; border-radius:4px; }
    .related-pagination button.active { background:#b30000; color:#fff; }

    /* === TELEGRAM POPUP === */
    #popup { position:fixed; bottom:100px; right:20px; background:#fff; border:2px solid #0088cc; border-radius:12px; padding:10px; display:flex; align-items:center; gap:10px; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:1000; }
    #popup img { width:30px; }
    #popup a { color:#0088cc; font-weight:bold; text-decoration:none; }
    #popup-close { margin-left:5px; cursor:pointer; color:#333; }
  </style>
</head>
<body>
  <header>
    <h1 id="homeLink">JAVTerabox</h1>
    <div id="search-box">
      <input type="text" id="searchInput" placeholder="Search code or actress...">
      <button id="searchBtn">Search</button>
    </div>
  </header>
  <main id="content">Loading...</main>

  <!-- === POPUP TELEGRAM === -->
  <div id="popup">
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram">
    <a href="https://t.me/asetplay" target="_blank">Join Telegram</a>
    <span id="popup-close">&#x2715;</span>
  </div>

  <script>
    const SHEET_URL = "https://opensheet.elk.sh/15m33t4659Iq9unQ7_Gi-lOPe6Jj9T7wzAA060HxyFRs/Sheet1";
    let allData = [];
    let currentPage = 1;
    const perPage = 20;

    async function fetchData() {
      const res = await fetch(SHEET_URL);
      const data = await res.json();
      allData = data.reverse(); // terbaru di depan
      renderList(1);
    }

    function renderList(page, searchTerm="") {
      currentPage = page;
      const content = document.getElementById("content");
      let filtered = allData;

      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        filtered = allData.filter(item => {
          return (item.CODE && item.CODE.toLowerCase().includes(term)) ||
                 (item.Actress && item.Actress.toLowerCase().includes(term));
        });
        if (filtered.length === 0) {
          filtered = allData.filter(item => {
            return (item.CODE && similarity(item.CODE.toLowerCase(), term) > 0.4) ||
                   (item.Actress && similarity(item.Actress.toLowerCase(), term) > 0.4);
          });
        }
      }

      const start = (page-1)*perPage;
      const paginated = filtered.slice(start, start+perPage);

      let html = `<div class="grid">`;
      paginated.forEach(item => {
        html += `
          <div class="card" onclick="renderDetail('${item.CODE}')">
            <img src="${item['LINK FOTO']}" alt="${item.CODE}">
            <h3>${item.CODE} ${item.Actress || ""}</h3>
          </div>`;
      });
      html += `</div>`;

      html += `<div class="pagination">`;
      const totalPages = Math.ceil(filtered.length/perPage);
      const maxPages = 5;
      let startPage = Math.max(1, page - 2);
      let endPage = Math.min(totalPages, startPage + maxPages - 1);
      if (endPage - startPage < maxPages - 1) startPage = Math.max(1, endPage - maxPages + 1);

      if (startPage > 1) html += `<button onclick="renderList(${startPage-1}, '${searchTerm}')"><</button>`;
      for (let i=startPage;i<=endPage;i++) {
        html += `<button class="${i===page?"active":""}" onclick="renderList(${i}, '${searchTerm}')">${i}</button>`;
      }
      if (endPage < totalPages) html += `<button onclick="renderList(${endPage+1}, '${searchTerm}')">></button>`;
      html += `</div>`;

      content.innerHTML = html;
      window.scrollTo({top:0, behavior:"smooth"});
    }

    function renderDetail(code) {
      const content = document.getElementById("content");
      const item = allData.find(d => d.CODE === code);
      if (!item) { content.innerHTML = "<p>Not found</p>"; return; }

      let html = `<div class="detail">`;
      html += `
        <div style="position:relative;">
          <img src="${item['LINK FOTO']}" alt="${item.CODE}">
          <div class="play-button"></div>
        </div>
        <h2>${item.CODE} ${item.Actress || ""}</h2>
        <div class="meta">
          <span onclick="searchTag('${item.Actress}')">${item.Actress || ""}</span>
          <span onclick="searchTag('${item.Studio}')">${item.Studio || ""}</span>
        </div>
        <a href="${item.LINK}" target="_blank" class="download-btn">Watch and Download</a>
        <a href="javascript:void(0)" class="back-btn" onclick="renderList(1)">Back to list</a>
      `;
      html += `</div>`;

      html += `<div class="related"><h3>Related Posts</h3><div id="relatedContent"></div><div id="relatedPagination" class="related-pagination"></div></div>`;

      content.innerHTML = html;
      renderRelated(code, 1);
      window.scrollTo({top:0, behavior:"smooth"});
    }

    function renderRelated(code, page) {
      const perRelated = 6;
      const baseItem = allData.find(d => d.CODE === code);
      let related = allData.filter(d => d.CODE !== code && d.Actress === baseItem.Actress);

      if (related.length === 0) related = allData.filter(d => d.CODE !== code);

      const start = (page-1)*perRelated;
      const paginated = related.slice(start, start+perRelated);

      let html = `<div class="related-grid">`;
      paginated.forEach(r => {
        html += `
          <div class="related-card" onclick="renderDetail('${r.CODE}')">
            <img src="${r['LINK FOTO']}" alt="${r.CODE}">
            <h4>${r.CODE} ${r.Actress || ""}</h4>
          </div>`;
      });
      html += `</div>`;
      document.getElementById("relatedContent").innerHTML = html;

      // Pagination
      const totalPages = Math.ceil(related.length/perRelated);
      let pg = "";
      for (let i=1;i<=totalPages;i++) {
        pg += `<button class="${i===page?"active":""}" onclick="renderRelated('${code}', ${i})">${i}</button>`;
      }
      document.getElementById("relatedPagination").innerHTML = pg;
    }

    function searchTag(tag) {
      renderList(1, tag);
    }

    // Fuzzy match simple
    function similarity(a,b) {
      let matches=0;
      for (let i=0;i<Math.min(a.length,b.length);i++) if (a[i]===b[i]) matches++;
      return matches/Math.max(a.length,b.length);
    }

    document.getElementById("searchBtn").addEventListener("click", ()=>{
      const term = document.getElementById("searchInput").value.trim();
      renderList(1, term);
    });
    document.getElementById("homeLink").addEventListener("click", ()=>renderList(1));

    document.getElementById("popup-close").addEventListener("click", ()=>document.getElementById("popup").style.display="none");

    fetchData();
  </script>
</body>
</html>
