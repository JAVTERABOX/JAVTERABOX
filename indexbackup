<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>JAVTerabox</title>
<link rel="icon" href="https://cdn-1.webcatalog.io/catalog/terabox/terabox-icon-filled-256.png" type="image/png">
<style>
:root{
--red:#d32f2f;--bg:#0f0f10;--card:#181818;--muted:#bdbdbd;--text:#f5f5f5;}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
header{position:sticky;top:0;background:var(--red);padding:12px 18px;display:flex;align-items:center;gap:16px;z-index:1200}
#logo{color:#fff;font-weight:800;font-size:20px;cursor:pointer}
#search-wrap{flex:1;display:flex;align-items:center;gap:8px}
#search{flex:1;padding:8px 12px;border-radius:8px;border:0;max-width:720px}
#searchBtn{background:rgba(255,255,255,0.1);border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
main{padding:18px;max-width:1300px;margin:0 auto}
.grid{display:grid;gap:18px}
@media(min-width:1200px){.grid{grid-template-columns:repeat(5,1fr);}}
@media(min-width:992px) and (max-width:1199px){.grid{grid-template-columns:repeat(4,1fr);}}
@media(min-width:768px) and (max-width:991px){.grid{grid-template-columns:repeat(3,1fr);}}
@media(max-width:767px){.grid{grid-template-columns:repeat(2,1fr);}}
.card{background:var(--card);border-radius:12px;overflow:hidden;cursor:pointer;display:flex;flex-direction:column;transition:.2s}
.card:hover{transform:translateY(-6px);box-shadow:0 8px 30px rgba(0,0,0,.6)}
.thumb{position:relative;width:100%;aspect-ratio:16/9;overflow:hidden;background:#222}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.title{padding:10px 12px;font-weight:700;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pagination{display:flex;justify-content:center;gap:8px;padding:18px 0}
.pg-btn{background:transparent;border:1px solid rgba(255,255,255,.1);color:var(--text);padding:8px 12px;border-radius:8px;cursor:pointer}
.pg-btn.active{background:var(--red);border-color:var(--red);color:#fff;font-weight:700}
.detail-wrap{max-width:980px;margin:16px auto;padding:18px;background:var(--card);border-radius:12px}
.breadcrumb{font-size:13px;color:var(--muted);margin-bottom:12px}
.detail-title{font-size:20px;margin:0 0 12px}
.poster-wrap{position:relative;display:block;margin:0 auto;max-width:720px;border-radius:12px;overflow:hidden}
.poster-wrap img{width:100%;height:auto;display:block}
.play-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:90px;height:90px;border-radius:50%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;cursor:pointer}
.play-overlay::after{content:'▶';color:#fff;font-size:36px}
.download-center{display:flex;justify-content:center;margin-top:14px}
.download-btn{background:var(--red);color:#fff;padding:12px 20px;border-radius:10px;text-decoration:none;font-weight:700}
.home-btn{display:block;width:160px;margin:18px auto 0;text-align:center;background:var(--red);color:#fff;padding:12px;border-radius:10px;text-decoration:none;font-weight:700}
.related-section{margin-top:28px}
.related-title{font-size:18px;margin:0 0 12px;color:var(--text)}
.related-grid{display:grid;gap:12px;grid-template-columns:repeat(3,1fr);}
@media(max-width:767px){.related-grid{grid-template-columns:repeat(2,1fr);}}
.related-item{cursor:pointer}
.related-item .thumb{aspect-ratio:16/9;border-radius:8px;overflow:hidden}
.related-item img{width:100%;height:100%;object-fit:cover;display:block}
.related-item .r-title{font-size:13px;margin-top:6px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;color:var(--text)}
.popup{position:fixed;right:18px;bottom:140px;z-index:4000;background:#fff;border-radius:12px;padding:10px 12px;display:flex;align-items:center;gap:10px;box-shadow:0 12px 30px rgba(0,0,0,.35);border:3px solid var(--red)}
.popup img{width:34px;height:34px}
.popup a{color:var(--red);font-weight:700;text-decoration:none}
.popup .close{cursor:pointer;font-weight:700;color:#333;margin-left:8px}
.msg{text-align:center;padding:12px;color:var(--muted)}
.hidden{display:none}
</style>
</head>
<body>

<header>
<div id="logo" onclick="resetToHome()">JAVTerabox</div>
<div id="search-wrap">
<input id="search" type="text" placeholder="Search Code, Actress, Tags..." />
<button id="searchBtn">Search</button>
</div>
</header>

<main id="main">
<div id="listView">
<div id="topMsg" class="msg hidden"></div>
<div id="grid" class="grid"></div>
<div id="pagination" class="pagination"></div>
</div>
<div id="detailView" class="hidden"></div>
</main>

<div id="popup" class="popup hidden">
<img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram" />
<a href="https://t.me/asetplay" target="_blank">Join Telegram @ASETPLAY</a>
<div class="close" id="popupClose">✕</div>
</div>

<script>
const OPEN_SHEET='https://opensheet.elk.sh/15m33t4659Iq9unQ7_Gi-lOPe6Jj9T7wzAA060HxyFRs/Sheet1';
const PER_PAGE=20,MAX_PAGE_BUTTONS=5,PLACEHOLDER='https://via.placeholder.com/640x360?text=No+Image';
let fullPosts=[],filteredPosts=[],currentPage=1;

function el(id){return document.getElementById(id)}
function safeImg(src){return src||PLACEHOLDER;}
async function init(){
  const resp=await fetch(OPEN_SHEET);
  const json=await resp.json();
  fullPosts=json.reverse();
  filteredPosts=fullPosts.slice();
  renderList(1);
  setTimeout(showPopupIfNeeded,1200);
}
function renderList(page=1){
  currentPage=Math.max(1,Math.floor(page));
  const total=filteredPosts.length,totalPages=Math.max(1,Math.ceil(total/PER_PAGE));
  if(currentPage>totalPages) currentPage=totalPages;
  const start=(currentPage-1)*PER_PAGE,pageItems=filteredPosts.slice(start,start+PER_PAGE);
  if(pageItems.length===0){el('grid').innerHTML='<div class="msg">No results.</div>';el('pagination').innerHTML='';return;}
  el('grid').innerHTML=pageItems.map(p=>{
    const img=safeImg(p['LINK FOTO']);const code=(p.CODE||'').trim();const actress=(p.Actress||'').trim();
    return `<div class="card" onclick="openDetail('${escapeJS(code)}')">
      <div class="thumb"><img src="${img}" onerror="this.src='${PLACEHOLDER}'" alt="${escapeHTML(code+' '+actress)}"/></div>
      <div class="title">${escapeHTML(code+' '+actress)}</div></div>`;}).join('');
  renderPagination(totalPages);el('listView').classList.remove('hidden');el('detailView').classList.add('hidden');window.scrollTo({top:0,behavior:'smooth'})
}
function renderPagination(totalPages){
  const c=el('pagination');if(totalPages<=1){c.innerHTML='';return;}
  let s=currentPage-Math.floor(MAX_PAGE_BUTTONS/2);if(s<1)s=1;
  let e=s+MAX_PAGE_BUTTONS-1;if(e>totalPages){e=totalPages;s=Math.max(1,e-MAX_PAGE_BUTTONS+1);}
  let html='';if(currentPage>1)html+=`<button class="pg-btn" onclick="renderList(${currentPage-1})">&lt;</button>`;
  for(let i=s;i<=e;i++){html+=`<button class="pg-btn ${i===currentPage?'active':''}" onclick="renderList(${i})">${i}</button>`}
  if(currentPage<totalPages)html+=`<button class="pg-btn" onclick="renderList(${currentPage+1})">&gt;</button>`;
  c.innerHTML=html
}
function doSearch(){
  const q=(el('search').value||'').trim().toLowerCase();const top=el('topMsg');top.classList.add('hidden');if(!q){filteredPosts=fullPosts.slice();renderList(1);return;}
  let res=fullPosts.filter(p=>((p.CODE||'')+(p.Actress||'')+(p.Tags||'')).toLowerCase().includes(q));
  if(res.length===0){const tokens=q.split(/\s+/).filter(Boolean);res=fullPosts.filter(p=>{const hay=((p.CODE||'')+' '+(p.Actress||'')+' '+(p.Tags||'')).toLowerCase();return tokens.every(t=>hay.includes(t))})}
  if(res.length===0){filteredPosts=fullPosts.slice();top.textContent=`No exact matches for "${q}", showing latest.`;top.classList.remove('hidden');renderList(1);return;}
  filteredPosts=res.slice();renderList(1)
}
function openDetail(code){
  const post=fullPosts.find(p=>(p.CODE||'').toUpperCase()===code.toUpperCase());if(!post)return;
  el('detailView').innerHTML=buildDetailHTML(post);
  el('listView').classList.add('hidden');
  el('detailView').classList.remove('hidden');
  window.scrollTo({top:0,behavior:'smooth'})
}
function buildDetailHTML(p){
  const code=p.CODE||'',actress=p.Actress||'',tags=(p.Tags||'').split(',').map(s=>s.trim()).filter(Boolean);
  const img=safeImg(p['LINK FOTO']);const link=escapeAttr(p.LINK||'#');
  const tagsHTML=tags.map(t=>`<span onclick="searchTag('${escapeJS(t)}')">${escapeHTML(t)}</span>`).join(' ');
  const actressHTML=(actress||'').split(',').map(a=>`<span onclick="searchTag('${escapeJS(a.trim())}')">${escapeHTML(a.trim())}</span>`).join(' ');
  const related=fullPosts.filter(x=>(x.CODE||'')!==code).slice(0,6);
  const relatedHTML=related.map(r=>`<div class="related-item" onclick="openDetail('${escapeJS(r.CODE)}')">
    <div class="thumb"><img src="${safeImg(r['LINK FOTO'])}" onerror="this.src='${PLACEHOLDER}'"></div>
    <div class="r-title">${escapeHTML(r.CODE+' '+(r.Actress||''))}</div></div>`).join('');
  return `<div class="detail-wrap">
    <div class="breadcrumb"><a href="javascript:resetToHome()">Home</a> › ${escapeHTML(actress)} › ${escapeHTML(code)}</div>
    <h2 class="detail-title">${escapeHTML(code+' '+actress)}</h2>
    <div style="text-align:center"><div class="poster-wrap"><img src="${img}" onerror="this.src='${PLACEHOLDER}'"><div class="play-overlay" onclick="window.open('${link}','_blank')"></div></div></div>
    <div class="download-center"><a class="download-btn" href="${link}" target="_blank">Watch and Download</a></div>
    <div style="text-align:center;margin-top:10px;color:var(--muted)">
      <div><strong>Actress:</strong> ${actressHTML}</div>
      <div style="margin-top:8px"><strong>Tags:</strong> ${tagsHTML||'—'}</div>
    </div>
    <a class="home-btn" href="javascript:resetToHome()">Home</a>
    <div class="related-section"><h3 class="related-title">Related Posts</h3><div class="related-grid">${relatedHTML}</div></div>
  </div>`;
}
function searchTag(tag){el('search').value=tag;doSearch()}
function resetToHome(){el('search').value='';el('topMsg').classList.add('hidden');filteredPosts=fullPosts.slice();renderList(1)}
function showPopupIfNeeded(){if(localStorage.getItem('popupClosed'))return;el('popup').classList.remove('hidden')}
el('popupClose').addEventListener('click',()=>{el('popup').classList.add('hidden');localStorage.setItem('popupClosed','1')})
el('searchBtn').addEventListener('click',doSearch)
el('search').addEventListener('keypress',e=>{if(e.key==='Enter')doSearch()})
function escapeJS(s){return(s||'').replace(/'/g,"\\'").replace(/"/g,'\\"')}
function escapeHTML(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function escapeAttr(s){return(s||'').replace(/"/g,'&quot;').replace(/'/g,"&#039;")}
init();
</script>

</body>
</html>
